---
- name: Create directories for extended configs
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: '0755'
  loop:
    - /etc/ssh_config.d
    - /etc/sshd_config.d

- name: Ensure extended configs are included
  ansible.builtin.lineinfile:
    path: "{{ item }}"
    line: "Include {{ item }}.d/*.conf"
  loop:
    - /etc/ssh/ssh_config
    - /etc/ssh/sshd_config

- name: Create hardened ssh client config
  ansible.builtin.copy:
    src: hardened_ssh_client.conf
    dest: /etc/ssh/ssh_config.d/hardened_ssh_client.conf
    owner: root
    group: root
    mode: 0644
  notify:
    - Restart sshd

- name: Create default (hardened) ssh server config
  ansible.builtin.copy:
    src: hardened_ssh_server.conf
    dest: /etc/ssh/sshd_config.d/hardened_ssh_server.conf
    owner: root
    group: root
    mode: 0644
  notify:
    - Restart sshd
